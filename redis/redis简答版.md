# Redis

## 优点

* 基于内存操作，速度快
* 支持持久化
* 支持事务
* 支持主从复制
* 单线程模式，6.0+多线程处理网络数据的读写和协议解析

## 缺点

* 对结构化查询的支持差
* 数据库容量收到物理内存的限制，不适合海量数据的高性能读写。
* 较难支持在线扩容，集群容量达到上限时在线扩容会变得很复杂

## 快的原因

* 基于内存
* IO多路复用
* 高效的数据结构

## Redis为什么主要用做缓存

* \[事物处理\] 无法做复杂的事物处理
* \[数据持久化\] 数据存储在内存，服务器奔溃或者断电时数据可能丢失，其本身的持久化机制也有限制
* \[数据结构\] 支持简单的数据结构
* \[数据安全\] 没有用户认证，访问控制之类的安全机制

## 线程模式

* 基于Reactor模式开发了网络事件处理器 - 文件时间处理器
  * 组成1: 多个套接字
  * 组成2: IO多路复用程序
  * 组成3: 文件事件分派器
  * 组成4: 事件处理器

## 应用场景

* 缓存热点数据
* 计数器
* 分布式会话
* 分布式锁
* 简单的消息队列
* 限速器
* 社交网络
* 排行榜

## Memcached和Redis 的区别

* 数据结构
  * MemCached: 单一
  * Redis: 支持多种数据类型
* 数据持久化
  * MemCached: 不支持
  * Redis: 支持
* 集群能力
  * MemCached: 无原生，依靠客户端实现
  * Redis: 提供主从同步机制和cluster集群部署能力
* 速度
  * MemCached: 不慢
  * Redis: 更快
* 线程
  * MemCached: 多线程的非堵塞IO模型
  * Redis: 单线程，6.0+多线程处理网络数据的读写和协议解析
* value值大小
  * MemCached: 1mb
  * Redis: 512M

## 数据类型

* 基本
  * String
  * Hash
  * Set
  * List
  * SortedSet
* 特殊
  * Bitmap
  * Hyperloglog
  * Geospatial

## SortedSet和List异同点

* 相同点
  * 都是有序的
  * 都可以获得某个范围内的元素
* 不同点
  * 列表基于链表实现，获取两端元素速度快，访问中间元素慢
  * 有序集合基于散列标和跳跃表实现，访问中间元素时间复杂度OlogN
  * 列表不能简单的调整某个元素的位置，有序列表可以
  * 有序集合更耗内存

## Redis 内存用完了会怎样？

* 写命令会返回错误信息，读命令正常
* 可以配置内存淘汰机制，当Redis达到内存上限时会冲刷掉旧的内容

## Redis如何做内存优化

* 利用好集合类型数据特性
* 对很多小k-V尽可能使用散列表

## Redis存在线程安全问题吗？

* 服务端安全
* 客户端在多客户端并发访问同一服务端是可能破坏原子性

## keys命令存在的问题

* keys指令会导致线程堵塞一段时间
* 可以用scan替代

## Redis事务

### 生命周期

* MULTI - 开启
* 操作的命令会插入一个队列中
* EXEC - 提交事务

### WAtCH命令

* 监控一个键，当被修改之后，后续的事务不会执行，执行exec之后会自动取消监控

### redis事务支持隔离吗？

* 事务带有隔离性

### redis事务保证原子性吗？

* 单条命令是原子性执行
* 事务不保证原子性

### redis事务支持回滚吗？

* 没有回滚
* 任意命令执行失败时，其余命令仍然执行

## 持久性机制
